import serial
import time
import sys
import tty
import termios

# ä¿®æ”¹æˆä½ çš„ä¸²å£å·ï¼Œä¾‹å¦‚ "/dev/ttyACM0" æˆ– "/dev/ttyUSB0"
PORT = "/dev/ttyACM0"
BAUD = 9600

# åˆå§‹åŒ–ä¸²å£è¿æ¥
try:
    ser = serial.Serial(PORT, BAUD, timeout=1)
    time.sleep(2)  # ç­‰å¾… Arduino é‡å¯
    print(f"âœ… Connected to Arduino on {PORT} at {BAUD} baud")
except serial.SerialException:
    print(f"âŒ Could not open port {PORT}")
    sys.exit()

# è¯»å–ä¸€ä¸ªæŒ‰é”®ï¼ˆéé˜»å¡ã€æ— éœ€å›è½¦ï¼‰
def get_key():
    fd = sys.stdin.fileno()
    old = termios.tcgetattr(fd)
    try:
        tty.setraw(fd)
        return sys.stdin.read(1)
    finally:
        termios.tcsetattr(fd, termios.TCSADRAIN, old)

# ä¸»æ§åˆ¶å¾ªç¯
print("ğŸ® æ§åˆ¶æŒ‡ä»¤ï¼šw=å‰è¿› s=åé€€ a=å·¦è½¬ d=å³è½¬ q=åœæ­¢ +=åŠ é€Ÿ -=å‡é€Ÿ")
print("ğŸ›‘ æŒ‰ ESC æˆ– Ctrl+C é€€å‡ºç¨‹åº")

try:
    while True:
        key = get_key()

        if key == '\x1b':  # ESC é”®
            print("ğŸšª é€€å‡ºç¨‹åº")
            break

        if key in ['w', 's', 'a', 'd', 'q', '+', '-']:
            ser.write(key.encode())
            print(f"â¡ï¸ å‘é€æŒ‡ä»¤: {key}")
        else:
            print(f"âš ï¸ æ— æ•ˆè¾“å…¥: {key}")

except KeyboardInterrupt:
    print("\nğŸ›‘ æ‰‹åŠ¨ä¸­æ–­ï¼Œé€€å‡ºç¨‹åº")

finally:
    ser.close()
    print("ğŸ”Œ ä¸²å£å·²å…³é—­")
