import serial
import time
import sys
import tty
import termios

# Modify the following text: Change it into your serial port name, such as "/dev/ttyACM0" or "/dev/ttyUSB0".
PORT = "/dev/ttyACM0"
BAUD = 9600

# Initialize the serial port connection.
try:
    ser = serial.Serial(PORT, BAUD, timeout=1)
    print(f"âœ… Connected to Arduino on {PORT} at {BAUD} baud")
except serial.SerialException:
    print(f"âŒ Could not open port {PORT}")
    sys.exit()

# Read a key press (non-blocking, without requiring Enter to be pressed).
def get_key():
    fd = sys.stdin.fileno()
    old = termios.tcgetattr(fd)
    try:
        tty.setraw(fd)
        return sys.stdin.read(1)
    finally:
        termios.tcsetattr(fd, termios.TCSADRAIN, old)

# Main control loop
print("ğŸ® æ§åˆ¶æŒ‡ä»¤ï¼šw=å‰è¿› s=åé€€ a=å·¦è½¬ d=å³è½¬ q=åœæ­¢ +=åŠ é€Ÿ -=å‡é€Ÿ")
print("ğŸ›‘ æŒ‰ ESC æˆ– Ctrl+C é€€å‡ºç¨‹åº")

try:
    while True:
        key = get_key()

        if key == '\x1b':  # ESC key
            print("ğŸšª é€€å‡ºç¨‹åº")
            break

        if key in ['w', 's', 'a', 'd', 'q', '+', '-']:
            ser.write(key.encode())
            print(f"â¡ï¸ å‘é€æŒ‡ä»¤: {key}")
        else:
            print(f"âš ï¸ æ— æ•ˆè¾“å…¥: {key}")

except KeyboardInterrupt:
    print("\nğŸ›‘ æ‰‹åŠ¨ä¸­æ–­ï¼Œé€€å‡ºç¨‹åº")

finally:
    ser.close()
    print("ğŸ”Œ ä¸²å£å·²å…³é—­")
